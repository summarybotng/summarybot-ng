# ADR-009: Schedule → Run → Summary Navigation

## Status
Proposed

## Context

Users need to trace the lineage of summaries through the system:
1. **From Schedule**: View all past executions (runs) of a schedule
2. **From Run**: View the summary generated by that specific execution
3. **From Retrospective**: Navigate to summaries generated by a retrospective job
4. **From Summary**: Trace back to the schedule or retrospective that created it

Currently, these relationships exist in the data model but are not exposed in the UI:
- `TaskResult.summary_id` links runs to summaries
- `StoredSummary.schedule_id` links summaries back to schedules
- `StoredSummary.source` indicates origin (SCHEDULED, ARCHIVE, MANUAL, REALTIME)
- Archive jobs create summaries with `source=ARCHIVE`

## Decision

### 1. Add Run History Panel to Schedule Details

**Location**: Schedule detail view (click on schedule card)

**UI Components**:
- Expandable "Run History" section showing recent executions
- Each run displays: timestamp, status (success/failed), duration
- Clickable runs link to the summary they generated (if any)
- Failed runs show error message with expandable details

**API**: `GET /guilds/{guild_id}/schedules/{schedule_id}/history` (already exists)

### 2. Add Schedule Source Badge to Summaries

**Location**: StoredSummaryCard component

**Display**:
- Badge showing source: "Scheduled", "Retrospective", "On-Demand", "Real-time"
- For scheduled summaries: clickable link to parent schedule
- For retrospective summaries: show period covered (e.g., "Jan 2025")

### 3. Add Summary Link to Run History Items

**Data Model Change**: Ensure `TaskResult.summary_id` is populated when:
- Scheduled task completes successfully
- Summary is stored to dashboard (destination includes DASHBOARD)

**UI Change**: Run history items show "View Summary" button when `summary_id` exists

### 4. Retrospective → Summaries Navigation

**Location**: Archive/Retrospective page

**Changes**:
- After generating retrospective summaries, show link to view them
- Retrospective job status includes count of summaries generated
- Add filter on Summaries page: "Source: Retrospective"

### 5. Summary Detail Navigation

**Location**: Summary detail drawer/modal

**Changes**:
- Show "Generated by" section with:
  - Schedule name + link (if from schedule)
  - "Retrospective: [period]" (if from archive)
  - "On-Demand" (if manual)
- Show generation timestamp
- Show channels summarized

## Implementation

### Phase 1: Run History (Immediate)
1. Add `useExecutionHistory` hook to frontend
2. Create `RunHistoryPanel` component
3. Integrate into schedule detail view
4. Wire up `summary_id` navigation

### Phase 2: Source Attribution (Short-term)
1. Update `StoredSummaryCard` to show source badge
2. Add `schedule_id` to summary list API response
3. Make source badge clickable for navigation

### Phase 3: Retrospective Integration (Medium-term)
1. Update archive job to return summary IDs
2. Add "View Summaries" action after retrospective completion
3. Add source filter to Summaries page

## API Changes

### Existing Endpoints (no changes needed)
- `GET /guilds/{guild_id}/schedules/{schedule_id}/history` - returns `ExecutionHistoryItem[]`

### Endpoint Enhancements
1. **`GET /guilds/{guild_id}/summaries`** - add `source` filter parameter
2. **`GET /guilds/{guild_id}/summaries/{id}`** - include `schedule_id`, `schedule_name` in response
3. **`GET /guilds/{guild_id}/schedules/{id}/history`** - ensure `summary_id` is included

## Consequences

### Positive
- Users can trace summary lineage end-to-end
- Easier debugging when summaries aren't as expected
- Better understanding of what triggered each summary
- Retrospective results are discoverable

### Negative
- Additional API calls for navigation
- Need to ensure `summary_id` is correctly populated in task execution
- UI complexity increases

### Risks
- `summary_id` may not be populated for historical runs (migration needed?)
- Large run histories may need pagination

## References
- ADR-006: Retrospective Summary Archive
- ADR-008: Unified Summary Experience
